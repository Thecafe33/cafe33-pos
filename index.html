<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cafe 33 Member</title>
    <meta name="theme-color" content="#006241">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=League+Spartan:wght@700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background: #F3F4F6; -webkit-tap-highlight-color: transparent; overscroll-behavior-y: none; }
        .brand-font { font-family: 'League Spartan', sans-serif; }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.5); }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        
        /* Nav Active State */
        .nav-item.active { color: #006241; background-color: #E6F4F1; font-weight: 800; }
        .nav-item { color: #9CA3AF; transition: all 0.2s; }
    </style>
</head>
<body class="bg-[#F2F2F7] min-h-screen flex flex-col relative overflow-hidden">

    <div id="loading-overlay" class="fixed inset-0 bg-white/95 z-[9999] hidden flex flex-col items-center justify-center backdrop-blur-sm">
        <div class="w-12 h-12 border-4 border-[#006241] border-t-transparent rounded-full animate-spin mb-3"></div>
        <p class="brand-font text-[#006241] animate-pulse">The cafe 33</p>
    </div>

    <div id="view-login" class="w-full h-screen flex flex-col items-center justify-center px-6 z-50 bg-[#F2F2F7]">
        <div class="glass-panel rounded-[40px] p-8 shadow-xl text-center w-full max-w-sm">
            <div class="w-20 h-20 bg-[#006241] rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg shadow-green-900/30">
                <span class="text-4xl">‚òï</span>
            </div>
            <h1 class="brand-font text-3xl text-[#006241] font-black uppercase tracking-wide mb-2">The Cafe 33</h1>
            <p class="text-xs text-gray-500 font-bold uppercase tracking-widest mb-8">D√†nh cho th√†nh vi√™n</p>
            <div class="space-y-4">
                <input type="tel" id="login-phone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i..." class="w-full p-5 bg-gray-50 rounded-[24px] text-center font-bold text-lg text-[#006241] outline-none border-2 border-transparent focus:border-[#006241] transition-all shadow-inner">
                <button onclick="handleLogin()" class="w-full py-5 bg-[#006241] text-white font-black rounded-[24px] uppercase text-sm shadow-xl shadow-green-900/20 active:scale-95 transition-all">Tra C·ª©u ƒêi·ªÉm</button>
            </div>
            <p id="login-error" class="text-[10px] text-red-500 font-bold mt-4 h-4"></p>
        </div>
    </div>

    <div id="view-dashboard" class="hidden w-full h-screen flex flex-col relative bg-[#F2F2F7]">
        
        <div class="bg-[#006241] pt-10 pb-20 px-6 rounded-b-[40px] shadow-lg shrink-0 relative z-10">
            <div class="flex justify-between items-start">
                <div onclick="document.getElementById('modal-profile').classList.remove('hidden')">
                    <p class="text-green-100/80 text-[10px] font-bold uppercase mb-1">Xin ch√†o,</p>
                    <h2 id="user-name" class="brand-font text-2xl text-white font-black truncate max-w-[200px]">--</h2>
                    <p class="text-[9px] text-amber-300 font-bold mt-1 cursor-pointer flex items-center gap-1">‚úé S·ª≠a h·ªì s∆°</p>
                </div>
                <div class="text-right">
                    <p class="text-[9px] text-green-100/80 font-bold uppercase mb-1">ƒêi·ªÉm t√≠ch l≈©y</p>
                    <p id="user-points" class="brand-font text-3xl text-white font-black">0</p>
                </div>
            </div>
        </div>

        <div class="flex-1 overflow-y-auto -mt-10 pt-12 pb-28 px-4 space-y-4 custom-scrollbar z-0" id="main-content">
            
            <div id="tab-home" class="space-y-4 animate-fade-in">
                <div class="bg-white p-5 rounded-[30px] shadow-sm border border-gray-100 flex items-center justify-between">
                    <div>
                        <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest mb-1">H·∫°ng th√†nh vi√™n</p>
                        <p class="text-lg font-black text-[#006241]" id="user-rank">Th√†nh Vi√™n</p>
                    </div>
                    <div class="w-12 h-12 bg-amber-100 text-amber-500 rounded-full flex items-center justify-center text-2xl shadow-inner">üëë</div>
                </div>

                <div>
                    <h3 class="text-xs font-black text-gray-400 uppercase tracking-widest mb-3 ml-2">L·ªãch s·ª≠ ho·∫°t ƒë·ªông</h3>
                    <div id="history-list" class="space-y-3 pb-10"></div>
                </div>
            </div>

            <div id="tab-booking" class="hidden space-y-5 animate-fade-in">
                <div class="bg-white p-6 rounded-[35px] shadow-sm border border-gray-100">
                    <h3 class="text-xl font-black text-[#006241] mb-6 text-center uppercase tracking-tight">ƒê·∫∑t ch·ªó Cafe in Bed</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="text-[10px] font-bold text-gray-400 uppercase ml-2 tracking-widest">Ng√†y ƒë·∫∑t</label>
                            <input type="date" id="book-date" class="w-full p-4 rounded-2xl bg-gray-50 outline-none mt-1 font-bold text-[#006241] border border-transparent focus:border-[#006241] text-center">
                        </div>
                        <div class="flex gap-3">
                            <div class="flex-1">
                                <label class="text-[10px] font-bold text-gray-400 uppercase ml-2">B·∫Øt ƒë·∫ßu</label>
                                <input type="time" id="book-start" class="w-full p-4 rounded-2xl bg-gray-50 outline-none mt-1 font-bold text-[#006241] border border-transparent focus:border-[#006241] text-center">
                            </div>
                            <div class="flex-1">
                                <label class="text-[10px] font-bold text-gray-400 uppercase ml-2">K·∫øt th√∫c</label>
                                <input type="time" id="book-end" class="w-full p-4 rounded-2xl bg-gray-50 outline-none mt-1 font-bold text-[#006241] border border-transparent focus:border-[#006241] text-center">
                            </div>
                        </div>
                        <div class="bg-amber-50 p-3 rounded-xl border border-amber-100 flex gap-2 items-start">
                            <span class="text-amber-500">‚ÑπÔ∏è</span>
                            <p class="text-[10px] text-amber-700 font-bold leading-relaxed">Qu√°n ho·∫°t ƒë·ªông: 08:00 - 20:50.<br>T·ªëi thi·ªÉu 30 ph√∫t/l·∫ßn ƒë·∫∑t.</p>
                        </div>
                    </div>

                    <div class="mt-6 space-y-3">
                        <label class="text-[10px] font-bold text-gray-400 uppercase ml-2 tracking-widest">Ng∆∞·ªùi ƒëi c√πng (T√πy ch·ªçn)</label>
                        <input type="text" id="book-cname" placeholder="T√™n b·∫°n ƒëi c√πng" class="w-full p-4 rounded-2xl bg-gray-50 outline-none text-sm font-bold">
                        <input type="tel" id="book-cphone" placeholder="SƒêT b·∫°n ƒëi c√πng" class="w-full p-4 rounded-2xl bg-gray-50 outline-none text-sm font-bold">
                    </div>

                    <button onclick="handleBookingSubmit()" class="w-full py-4 mt-8 bg-[#006241] text-white font-black rounded-2xl uppercase text-sm shadow-lg shadow-green-900/20 active:scale-95 transition-all">X√°c nh·∫≠n ƒë·∫∑t Bed</button>
                </div>
            </div>

            <div id="tab-rewards" class="hidden space-y-4 animate-fade-in">
                <div id="rewards-list" class="grid grid-cols-2 gap-3 pb-10"></div>
            </div>

        </div>

        <div class="absolute bottom-6 left-6 right-6 h-20 bg-white rounded-[30px] shadow-[0_10px_40px_rgba(0,0,0,0.1)] flex items-center justify-between px-2 z-50 border border-gray-100">
            <button onclick="switchTab('home')" id="nav-home" class="nav-item active flex-1 h-full rounded-[24px] flex flex-col items-center justify-center gap-1 transition-all">
                <span class="text-2xl">üè†</span>
                <span class="text-[9px] uppercase tracking-widest">Trang ch·ªß</span>
            </button>
            <button onclick="switchTab('booking')" id="nav-booking" class="nav-item flex-1 h-full rounded-[24px] flex flex-col items-center justify-center gap-1 transition-all">
                <span class="text-2xl">üõå</span>
                <span class="text-[9px] uppercase tracking-widest">ƒê·∫∑t Bed</span>
            </button>
            <button onclick="switchTab('rewards')" id="nav-rewards" class="nav-item flex-1 h-full rounded-[24px] flex flex-col items-center justify-center gap-1 transition-all">
                <span class="text-2xl">üéÅ</span>
                <span class="text-[9px] uppercase tracking-widest">ƒê·ªïi qu√†</span>
            </button>
        </div>
    </div>

    <div id="modal-profile" class="fixed inset-0 bg-black/50 z-[60] hidden flex items-center justify-center p-6 backdrop-blur-sm animate-fade-in">
        <div class="bg-white rounded-[35px] p-8 w-full max-w-sm shadow-2xl">
            <h3 class="brand-font text-xl text-[#006241] mb-6 text-center uppercase font-black">C·∫≠p nh·∫≠t h·ªì s∆°</h3>
            <div class="space-y-3">
                <input id="edit-name" type="text" placeholder="T√™n c·ªßa b·∫°n" class="w-full p-4 bg-gray-50 rounded-2xl text-sm font-bold text-[#006241] outline-none border border-transparent focus:border-[#006241]">
                <input id="edit-comp-name" type="text" placeholder="T√™n ng∆∞·ªùi ƒëi c√πng" class="w-full p-4 bg-gray-50 rounded-2xl text-sm font-bold text-[#006241] outline-none border border-transparent focus:border-[#006241]">
                <input id="edit-comp-phone" type="tel" placeholder="SƒêT ng∆∞·ªùi ƒëi c√πng" class="w-full p-4 bg-gray-50 rounded-2xl text-sm font-bold text-[#006241] outline-none border border-transparent focus:border-[#006241]">
            </div>
            <div class="grid grid-cols-2 gap-3 mt-6">
                <button onclick="document.getElementById('modal-profile').classList.add('hidden')" class="py-3 bg-gray-100 text-gray-500 rounded-xl font-bold text-xs uppercase">H·ªßy</button>
                <button onclick="saveProfile()" class="py-3 bg-[#006241] text-white rounded-xl font-bold text-xs shadow-lg uppercase">L∆∞u thay ƒë·ªïi</button>
            </div>
        </div>
    </div>

    <script>
        // =============================================================
        // 1. C·∫§U H√åNH (D√ÅN T·ª™ FILE POS V√ÄO ƒê√ÇY)
        // =============================================================
        const firebaseConfig = {
            apiKey: "AIzaSyCNh1-16gYZ0P30Fkd-2tB-O89PXkPX9Lc",
            authDomain: "the-cafe-33.firebaseapp.com",
            databaseURL: "https://the-cafe-33-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "the-cafe-33",
            storageBucket: "the-cafe-33.appspot.com",
            messagingSenderId: "...",
            appId: "..."
        };
        
        // D√ÅN LINK WEB APP M·ªöI NH·∫§T V√ÄO ƒê√ÇY
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/......./exec"; 

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let curPhone = localStorage.getItem('member_phone');
        let userData = {};

        // =============================================================
        // 2. KH·ªûI ƒê·ªòNG
        // =============================================================
        window.onload = function() {
            // Set min date cho booking
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('book-date').setAttribute('min', today);
            
            if(curPhone) showDashboard(curPhone);
        };

        function normalizePhone(p) { return String(p || "").replace(/[^0-9]/g, ""); }

        function handleLogin() {
            const phone = normalizePhone(document.getElementById('login-phone').value);
            if (phone.length < 9) return document.getElementById('login-error').innerText = "SƒêT kh√¥ng h·ª£p l·ªá!";

            document.getElementById('loading-overlay').classList.remove('hidden');
            
            db.ref('customers/' + phone).once('value', snap => {
                document.getElementById('loading-overlay').classList.add('hidden');
                if (snap.exists()) {
                    localStorage.setItem('member_phone', phone);
                    showDashboard(phone);
                } else {
                    document.getElementById('login-error').innerText = "SƒêT ch∆∞a ƒëƒÉng k√Ω!";
                }
            });
        }

        function handleLogout() {
            localStorage.removeItem('member_phone');
            location.reload();
        }

        function showDashboard(phone) {
            curPhone = phone;
            document.getElementById('view-login').classList.add('hidden');
            document.getElementById('view-dashboard').classList.remove('hidden');

            // L·∫Øng nghe User Realtime
            db.ref('customers/' + phone).on('value', snap => {
                userData = snap.val();
                if(userData) {
                    document.getElementById('user-name').innerText = userData.name;
                    document.getElementById('user-points').innerText = (userData.points || 0).toLocaleString();
                    
                    // ƒêi·ªÅn form
                    document.getElementById('edit-name').value = userData.name;
                    document.getElementById('edit-comp-name').value = userData.compName || userData.companionName || "";
                    document.getElementById('edit-comp-phone').value = userData.compPhone || userData.companionPhone || "";
                    
                    document.getElementById('book-cname').value = userData.compName || userData.companionName || "";
                    document.getElementById('book-cphone').value = userData.compPhone || userData.companionPhone || "";
                }
            });

            loadHistory(phone);
            loadRewards();
        }

        // =============================================================
        // 3. X·ª¨ L√ù ƒê·∫∂T BED (POS STYLE - CHECK TR·ª∞C TI·∫æP FIREBASE)
        // =============================================================
        function handleBookingSubmit() {
            const date = document.getElementById('book-date').value;
            const start = document.getElementById('book-start').value;
            const end = document.getElementById('book-end').value;
            const cName = document.getElementById('book-cname').value;
            const cPhone = document.getElementById('book-cphone').value;

            if(!date || !start || !end) return alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß ng√†y gi·ªù!");
            if(start >= end) return alert("Gi·ªù k·∫øt th√∫c ph·∫£i sau gi·ªù b·∫Øt ƒë·∫ßu!");
            if(start < "08:00" || end > "20:50") return alert("Qu√°n m·ªü t·ª´ 08:00 ƒë·∫øn 20:50 ·∫°!");

            // T√≠nh ph√∫t
            const startMin = parseInt(start.split(':')[0])*60 + parseInt(start.split(':')[1]);
            const endMin = parseInt(end.split(':')[0])*60 + parseInt(end.split(':')[1]);
            if(endMin - startMin < 30) return alert("Th·ªùi gian t·ªëi thi·ªÉu l√† 30 ph√∫t!");

            document.getElementById('loading-overlay').classList.remove('hidden');

            // B∆Ø·ªöC 1: L·∫§Y L·ªäCH C·ª¶A NG√ÄY ƒê√ì T·ª™ FIREBASE
            // Convert ng√†y sang dd/mm/yyyy ƒë·ªÉ kh·ªõp v·ªõi d·ªØ li·ªáu POS
            const dateStr = convertDate(date);

            db.ref('bedBookings').orderByChild('date').equalTo(dateStr).once('value', snap => {
                const bookings = [];
                snap.forEach(child => {
                    const val = child.val();
                    // L·ªçc nh·ªØng ƒë∆°n ch∆∞a h·ªßy v√† ch∆∞a xong
                    if(val.status !== 'ƒë√£ h·ªßy' && val.status !== 'ƒë√£ xong') {
                        bookings.push(val);
                    }
                });

                // B∆Ø·ªöC 2: T√åM GI∆Ø·ªúNG TR·ªêNG (1-4)
                let availableBed = null;
                for(let bed = 1; bed <= 4; bed++) {
                    let isBusy = false;
                    for(let b of bookings) {
                        if(b.bedId == bed) {
                            const bStart = parseInt(b.start.split(':')[0])*60 + parseInt(b.start.split(':')[1]);
                            const bEnd = parseInt(b.end.split(':')[0])*60 + parseInt(b.end.split(':')[1]);
                            // Check va ch·∫°m: Max(StartA, StartB) < Min(EndA, EndB)
                            if(Math.max(startMin, bStart) < Math.min(endMin, bEnd)) {
                                isBusy = true; break;
                            }
                        }
                    }
                    if(!isBusy) {
                        availableBed = bed;
                        break;
                    }
                }

                if(availableBed) {
                    // B∆Ø·ªöC 3: ƒê·∫®Y ƒê∆†N L√äN FIREBASE (POS TH·∫§Y NGAY)
                    const newBooking = {
                        phone: curPhone,
                        name: userData.name,
                        date: dateStr, 
                        start: start,
                        end: end,
                        compName: cName,
                        compPhone: cPhone,
                        bedId: availableBed,
                        status: "ch·ªù kh√°ch", // POS s·∫Ω th·∫•y m√†u v√†ng
                        type: "app",
                        createdAt: new Date().toISOString()
                    };

                    db.ref('bedBookings').push(newBooking, (err) => {
                        document.getElementById('loading-overlay').classList.add('hidden');
                        if(err) alert("L·ªói: " + err.message);
                        else {
                            alert(`ƒê·∫∑t th√†nh c√¥ng! B·∫°n ƒë∆∞·ª£c x·∫øp v√†o BED 0${availableBed}`);
                            document.getElementById('book-date').value = "";
                            switchTab('home');
                        }
                    });
                } else {
                    document.getElementById('loading-overlay').classList.add('hidden');
                    alert("Gi·ªù n√†y ƒë√£ k√≠n h·∫øt 4 Bed r·ªìi ·∫°. Vui l√≤ng ch·ªçn gi·ªù kh√°c!");
                }
            });
        }

        function convertDate(yyyy_mm_dd) {
            const p = yyyy_mm_dd.split('-');
            return `${p[2]}/${p[1]}/${p[0]}`;
        }

        // =============================================================
        // 4. QU√Ä T·∫∂NG & H·ªí S∆† (D√πng c∆° ch·∫ø POS Style ƒë√£ duy·ªát)
        // =============================================================
        function loadRewards() {
            db.ref('rewards').on('value', snap => {
                const list = document.getElementById('rewards-list');
                list.innerHTML = "";
                const rewards = snap.val();
                if (!rewards) { list.innerHTML = '<p class="text-gray-400 text-xs col-span-2 text-center">Ch∆∞a c√≥ qu√†.</p>'; return; }

                Object.values(rewards).forEach(r => {
                    const cost = parseInt(r.cost);
                    const canRedeem = ((userData.points || 0) >= cost);
                    const btnClass = canRedeem ? "bg-[#006241] text-white shadow-md active:scale-95" : "bg-gray-200 text-gray-400 cursor-not-allowed";
                    
                    list.innerHTML += `
                    <div class="bg-white p-4 rounded-[24px] shadow-sm border border-gray-100 flex flex-col items-center text-center">
                        <div class="w-16 h-16 rounded-2xl bg-gray-50 mb-3 overflow-hidden border border-gray-100">
                            <img src="${r.img}" class="w-full h-full object-cover">
                        </div>
                        <p class="text-xs font-black text-[#1e3932] mb-1 truncate w-full uppercase">${r.name}</p>
                        <p class="text-[10px] font-bold text-amber-500 mb-3">${cost.toLocaleString()} ƒëi·ªÉm</p>
                        <button onclick="redeemGift('${r.name}', ${cost})" ${canRedeem ? '' : 'disabled'} class="w-full py-2.5 rounded-xl text-[10px] font-black uppercase transition-all ${btnClass}">ƒê·ªïi</button>
                    </div>`;
                });
            });
        }

        function redeemGift(giftName, cost) {
            if(!confirm(`ƒê·ªïi [${giftName}] v·ªõi ${cost} ƒëi·ªÉm?`)) return;
            const newPoints = (userData.points || 0) - cost;
            if(newPoints < 0) return alert("Kh√¥ng ƒë·ªß ƒëi·ªÉm!");

            document.getElementById('loading-overlay').classList.remove('hidden');
            // C·∫≠p nh·∫≠t Firebase ngay
            db.ref('customers/' + curPhone).update({ points: newPoints });

            // Ghi log v√†o Sheet
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST', mode: 'no-cors',
                body: JSON.stringify({ action: 'logRedeem', phone: curPhone, custName: userData.name, giftName: giftName, pointCost: cost })
            }).finally(() => {
                document.getElementById('loading-overlay').classList.add('hidden');
                alert("ƒê·ªïi qu√† th√†nh c√¥ng!");
            });
        }

        function saveProfile() {
            const newName = document.getElementById('edit-name').value;
            const newComp = document.getElementById('edit-comp-name').value;
            const newCompPhone = document.getElementById('edit-comp-phone').value;
            const oldData = { ...userData };

            document.getElementById('modal-profile').classList.add('hidden');
            document.getElementById('loading-overlay').classList.remove('hidden');

            // C·∫≠p nh·∫≠t Firebase
            db.ref('customers/' + curPhone).update({ name: newName, compName: newComp, compPhone: newCompPhone });

            // Ghi log v√†o Sheet
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST', mode: 'no-cors',
                body: JSON.stringify({ action: 'logProfileUpdate', phone: curPhone, oldName: oldData.name, newName: newName, oldComp: oldData.compName || "", newComp: newComp })
            }).finally(() => {
                document.getElementById('loading-overlay').classList.add('hidden');
                alert("ƒê√£ c·∫≠p nh·∫≠t h·ªì s∆°!");
            });
        }

        function loadHistory(phone) {
            db.ref('orders').orderByChild('createdAt').limitToLast(20).on('value', snap => {
                const list = document.getElementById('history-list');
                list.innerHTML = "";
                const orders = [];
                snap.forEach(child => { if (normalizePhone(child.val().sdt) === phone) orders.push(child.val()); });

                if(orders.length == 0) list.innerHTML = '<p class="text-center text-gray-400 text-xs italic">Ch∆∞a c√≥ ƒë∆°n h√†ng.</p>';

                orders.reverse().forEach(o => {
                    const d = new Date(o.createdAt);
                    const timeStr = d.toLocaleDateString('vi-VN') + " " + d.toLocaleTimeString('vi-VN', {hour:'2-digit', minute:'2-digit'});
                    list.innerHTML += `
                    <div class="bg-white p-4 rounded-[24px] shadow-sm border border-gray-100 flex justify-between items-center">
                        <div>
                            <p class="text-[9px] text-gray-400 font-bold uppercase mb-1">${timeStr}</p>
                            <p class="text-xs font-bold text-gray-700 w-48 truncate">${o.items}</p>
                        </div>
                        <p class="text-sm font-black text-[#006241]">${Number(o.total).toLocaleString()}ƒë</p>
                    </div>`;
                });
            });
        }

        function switchTab(t) {
            // ·∫®n t·∫•t c·∫£ Tab n·ªôi dung (D·ª±a v√†o ID parent c·ªßa ch√∫ng)
            document.getElementById('tab-home').parentElement.classList.remove('hidden'); 
            
            // ·∫®n c·ª• th·ªÉ t·ª´ng kh·ªëi
            document.getElementById('tab-home').classList.add('hidden');
            document.getElementById('tab-booking').classList.add('hidden');
            document.getElementById('tab-rewards').classList.add('hidden');
            
            // Hi·ªán c√°i c·∫ßn hi·ªán
            document.getElementById('tab-' + t).classList.remove('hidden');
            
            // Update Active Nav
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            document.getElementById('nav-' + t).classList.add('active');
        }

        function animateValue(id, start, end, duration) {
            if (start === end) return;
            const range = end - start;
            let current = start;
            const increment = end > start ? Math.ceil(range/20) : Math.floor(range/20);
            const stepTime = Math.abs(Math.floor(duration / (range / increment)));
            const obj = document.getElementById(id);
            const timer = setInterval(function() {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) { current = end; clearInterval(timer); }
                obj.innerHTML = current.toLocaleString();
            }, stepTime);
        }
    </script>
</body>
</html>
